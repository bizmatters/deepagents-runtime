apiVersion: platform.bizmatters.io/v1alpha1
kind: EventDrivenService
metadata:
  name: agent-executor
  namespace: intelligence-deepagents
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  image: ghcr.io/arun4infra/agent-executor:latest
  size: medium
  nats:
    stream: AGENT_EXECUTION
    consumer: agent-executor-workers
  # Secrets with standard environment variable names (envFrom)
  secret1Name: agent-executor-db-conn      # POSTGRES_HOST, POSTGRES_PORT, POSTGRES_DB, POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_SCHEMA
  secret2Name: agent-executor-cache-conn   # DRAGONFLY_HOST, DRAGONFLY_PORT, DRAGONFLY_PASSWORD
  secret3Name: agent-executor-llm-keys     # OPENAI_API_KEY, ANTHROPIC_API_KEY
  imagePullSecrets:
    - name: ghcr-pull-secret
  initContainer:
    command: ["/bin/bash", "-c"]
    args: ["cd /app && ./scripts/ci/run-migrations.sh"]
